<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aashi's Professional Portfolio - Neon Theme</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* --- CSS STYLING (Same as before, with additions for Login button) --- */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

        :root {
            --neon-color-purple: #8A2BE2; 
            --neon-color-orange: #FF8C00; 
            --dark-bg: #1a0332; 
            --card-bg: #290850;
            --text-color: #ffffff;
            --shadow-purple: 0 0 5px var(--neon-color-purple), 0 0 15px var(--neon-color-purple);
            --shadow-orange: 0 0 5px var(--neon-color-orange), 0 0 15px var(--neon-color-orange);
            --google-blue: #4285F4;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px 0;
        }

        .neon-text {
            color: var(--text-color);
            text-shadow: var(--shadow-purple);
        }

        .neon-border {
            border: 2px solid var(--neon-color-purple);
            background: rgba(41, 8, 80, 0.4);
            box-shadow: 0 0 10px var(--neon-color-purple), 0 0 20px rgba(138, 43, 226, 0.5);
            transition: all 0.3s ease;
            border-radius: 15px;
            padding: 20px;
        }

        /* --- Profile Card --- */
        .profile-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding: 30px;
            position: relative; 
        }
        .profile-info h1 { font-size: 3.5em; margin: 0; }
        .profile-info p { font-size: 1.2em; opacity: 0.8; }
        .profile-image img {
            width: 150px; height: 150px; border-radius: 50%; object-fit: cover;
            border: 3px solid var(--neon-color-purple);
            box-shadow: 0 0 15px var(--neon-color-purple), 0 0 30px rgba(138, 43, 226, 0.7);
        }

        /* --- Login/Logout Display Area --- */
        #auth-status {
            position: absolute;
            top: 20px;
            right: 20px;
            text-align: right;
            font-size: 0.9em;
        }
        #login-button {
            background-color: var(--google-blue);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
            box-shadow: 0 0 10px rgba(66, 133, 244, 0.5);
        }
        #logout-button {
            background-color: #8B0000;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            margin-left: 10px;
            display: none; 
        }
        
        /* --- Rating Section --- */
        .rating-section {
            text-align: center;
            padding: 40px 20px;
            margin-top: 40px;
        }
        .stars i.selected, .stars i:hover {
            color: var(--neon-color-orange);
            text-shadow: var(--shadow-orange);
        }
        #submit-rating {
            padding: 12px 30px; 
            font-size: 1.1em;
        }
        #rating-message {
            min-height: 20px; 
            font-style: italic; 
            margin-bottom: 15px;
        }

        /* Remaining CSS for Skills/Projects is unchanged */
        .grid-section { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 40px; }
        .projects-section { grid-template-columns: 1fr 1fr; }
        .commands p { background: #4B0082; padding: 8px 12px; margin: 8px 0; border-radius: 5px; font-family: monospace; font-size: 0.95em; }
        .neon-button { background: var(--neon-color-purple); color: var(--text-color); border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; text-transform: uppercase; font-weight: 600; box-shadow: 0 0 5px var(--neon-color-purple); transition: all 0.3s ease; }
        .neon-button:hover, .neon-button:active { background: var(--neon-color-orange); box-shadow: var(--shadow-orange); transform: scale(1.03); }
        .stars { font-size: 2.5em; margin-bottom: 15px; display: flex; justify-content: center; gap: 5px; }
        .stars i { color: #4a4a4a; cursor: pointer; transition: all 0.2s; }
        
        /* Theme Toggle placeholder style */
        #theme-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            background: #FF8C00;
            border-radius: 50px;
            font-size: 0.7em;
            width: 30px;
            height: 30px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="container">
        <header class="profile-card neon-border">
            <div class="profile-info">
                <h1>Hello, I'm <span class="neon-text">Aashi</span></h1>
                <p>Linux Automation Engineer</p>
            </div>
            <div class="profile-image">
                <img id="profile-pic" src="https://via.placeholder.com/150/8A2BE2/FFFFFF?text=Aashi" alt="Aashi's Profile Picture">
            </div>
             
             <div id="auth-status">
                <p id="user-display">Please Login to Rate.</p>
                <button id="login-button"><i class="fab fa-google"></i> Login with Google</button>
                <button id="logout-button">Logout</button>
            </div>
             <div style="position: absolute; top: 20px; right: 220px;">
                <span style="font-size: 0.9em; margin-right: 5px;">Dark</span>
                <button id="theme-toggle" class="neon-button" style="padding: 5px; border-radius: 50%; width: 30px; height: 30px;"></button>
            </div>
            
        </header>

        <section class="grid-section">
            <div class="skill-card neon-border">
                <h2>File Permissions <span style="opacity: 0.5; font-size: 0.8em;">Comm</span></h2>
                <div class="commands">
                    <p>chmod 755 g.txt</p>
                    <p>chmod .5.9.0 dir</p>
                    <p>choun root-file</p>
                    <p>getfacl file</p>
                    <button class="neon-button close-btn">Close</button>
                </div>
            </div>

            <div class="skill-card neon-border menu-card">
                <button class="menu-btn neon-button">User</button>
                <button class="menu-btn neon-button">Group Gama.</button>
                <button class="menu-btn neon-button active">File Permissions</button>
                <button class="menu-btn neon-button">Cron</button>
                <button class="menu-btn neon-button">Firewall</button>
                <button class="menu-btn neon-button">Networking</button>
                <button class="menu-btn neon-button">YUM / DNF / RPM</button>
                <button class="menu-btn neon-button">Local</button>
            </div>
        </section>

        <section class="grid-section projects-section">
            <div class="project-card neon-border">
                <h2>Projects</h2>
                <ul>
                    <li>✅ Linux automation scripts for backups, cron & monitoring.</li>
                </ul>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <i class="fas fa-circle" style="color: var(--neon-color-purple);"></i>
                    <i class="fas fa-user-lock" style="color: var(--neon-color-purple);"></i>
                </div>
            </div>
            
            <div class="project-card neon-border project-menu">
                <button class="menu-btn neon-button">User Permissions</button>
                <button class="menu-btn neon-button">Group Management</button>
                <button class="menu-btn neon-button">Cron Jobs</button>
            </div>
        </section>

        <hr style="border-color: rgba(138, 43, 226, 0.3); margin: 40px 0;">

        <section class="rating-section neon-border">
            <h2 class="neon-text">Rate Aashi!</h2>
            
            <div class="stars" id="rating-stars"></div>
            
            <p id="rating-message"></p>
            
            <button id="submit-rating" class="neon-button" disabled>
                Submit Rating
            </button>

            <div class="rating-info">
                <span id="avg-rating">Average Rating: 0.0 / 5.0</span> 
                <span id="user-count">(0 users rated)</span>
            </div>
        </section>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script> 
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <script>
        // --- JAVASCRIPT LOGIC (Updated for Google Auth and Config) ---
        
        // 1. Firebase Configuration - *IMPORTANT: REPLACE these values with your actual config from Firebase Console*
        const firebaseConfig = {
            apiKey: "AIzaSyC2dE_FAKE_API_KEY", // <--- ⚠️ अपनी असली API Key यहाँ डालें
            authDomain: "aashi-portfolio-12345.firebaseapp.com", // <--- ⚠️ अपनी असली Auth Domain यहाँ डालें
            databaseURL: "https://aashi-portfolio-12345-default-rtdb.firebaseio.com", // ⚠️ अपनी असली Database URL यहाँ डालें
            projectId: "aashi-portfolio-12345", // <--- ⚠️ अपनी असली Project ID यहाँ डालें
            // If you have other keys like storageBucket, messagingSenderId, etc., add them here.
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        
        // Firebase Services
        const auth = firebase.auth(); // Added for Google Login
        const database = firebase.database();
        const ratingsRef = database.ref('aashi_portfolio_ratings'); 

        // UI Elements
        const starsContainer = document.getElementById('rating-stars');
        const submitButton = document.getElementById('submit-rating');
        const avgRatingSpan = document.getElementById('avg-rating');
        const userCountSpan = document.getElementById('user-count');
        const message = document.getElementById('rating-message');
        const loginButton = document.getElementById('login-button'); 
        const logoutButton = document.getElementById('logout-button'); 
        const userDisplay = document.getElementById('user-display'); 
        const themeToggle = document.getElementById('theme-toggle'); // Theme Toggle

        let userSelectedRating = 0;
        let currentUser = null; 

        // --- AUTHENTICATION LOGIC ---

        // 1. Google Login Handler
        loginButton.addEventListener('click', () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then((result) => {
                    // Login successful, onAuthStateChanged will handle the rest
                })
                .catch((error) => {
                    console.error("Google login error:", error);
                    alert("Login failed: " + error.message);
                });
        });

        // 2. Logout Handler
        logoutButton.addEventListener('click', () => {
            auth.signOut().then(() => {
                // Logged out successfully
            }).catch((error) => {
                console.error("Logout error:", error);
            });
        });

        // 3. User State Change Listener (Most Important for Auth)
        auth.onAuthStateChanged((user) => {
            currentUser = user; 
            
            if (user) {
                // User is logged in
                userDisplay.innerHTML = Welcome, <b>${user.displayName.split(' ')[0]}</b>!;
                loginButton.style.display = 'none';
                logoutButton.style.display = 'inline';
                message.textContent = "Select stars and click 'Submit Rating'.";
                
                // Check if user has already rated
                checkIfUserRated(user.uid);
                
            } else {
                // User is logged out
                userDisplay.textContent = "Please Login to Rate.";
                loginButton.style.display = 'block';
                logoutButton.style.display = 'none';
                submitButton.disabled = true;
                submitButton.textContent = "Submit Rating";
                message.textContent = "";
                // Reset UI
                updateStarDisplay(0, true);
                userSelectedRating = 0; // Reset selected rating
            }
        });

        // 4. Check if User Has Already Rated
        function checkIfUserRated(uid) {
            database.ref('user_ratings_status/' + uid).once('value')
                .then((snapshot) => {
                    if (snapshot.exists()) {
                        // User has rated
                        submitButton.disabled = true;
                        submitButton.textContent = "You Have Already Rated!";
                        message.textContent = "Thank you for your rating!";
                        const userRating = snapshot.val().rating;
                        updateStarDisplay(userRating, true);
                        userSelectedRating = userRating;
                    } else {
                        // User can rate
                        submitButton.disabled = false;
                        submitButton.textContent = "Submit Rating";
                        message.textContent = "Select stars and click 'Submit Rating'.";
                    }
                });
        }
        
        // --- RATING STAR FUNCTIONALITY ---
        for (let i = 1; i <= 5; i++) {
            const star = document.createElement('i');
            star.className = 'fas fa-star';
            star.dataset.rating = i;
            starsContainer.appendChild(star);

            star.addEventListener('click', () => {
                if (!currentUser || submitButton.disabled) return; 
                userSelectedRating = i;
                updateStarDisplay(i, true);
                message.textContent = You have selected: ${i} Stars. Ready to submit.;
            });

            star.addEventListener('mouseover', () => {
                if (!currentUser || submitButton.disabled) return;
                updateStarDisplay(i, false);
            });

            star.addEventListener('mouseout', () => {
                if (!currentUser || submitButton.disabled) return;
                updateStarDisplay(userSelectedRating, true);
            });
        }
        
        function updateStarDisplay(rating, persist) {
            const stars = starsContainer.querySelectorAll('i');
            stars.forEach(star => {
                const starRating = parseInt(star.dataset.rating);
                if (starRating <= rating) {
                    star.classList.add('selected');
                } else {
                    star.classList.remove('selected');
                }
            });
        }


        // --- FIREBASE INTEGRATION ---

        // 5. Handle Rating Submission (Updated to save User Data)
        submitButton.addEventListener('click', () => {
            if (!currentUser) {
                alert("Please log in with Google first to submit a rating!");
                return;
            }
            if (userSelectedRating === 0) {
                message.textContent = "Please select a star rating first!";
                return;
            }
            if (submitButton.disabled) return; 

            submitButton.disabled = true;
            submitButton.textContent = "Submitting...";

            const ratingData = {
                rating: userSelectedRating,
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                userName: currentUser.displayName, 
                userEmail: currentUser.email,     
                userUID: currentUser.uid,         
            };

            // 1. Push rating to the main list (aashi_portfolio_ratings)
            ratingsRef.push(ratingData)
            .then(() => {
                // 2. Save user's rating status (user_ratings_status) to prevent repeat ratings
                return database.ref('user_ratings_status/' + currentUser.uid).set({
                    rating: userSelectedRating,
                    timestamp: firebase.database.ServerValue.TIMESTAMP,
                    email: currentUser.email
                });
            })
            .then(() => {
                // Success Message & UI Update
                message.textContent = Your rating of ${userSelectedRating} stars submitted! Thank you!;
                submitButton.textContent = "Rating Submitted!";
                submitButton.style.backgroundColor = 'gray';
                
                // Simulating a temporary "popup" effect
                submitButton.style.boxShadow = '0 0 20px #22ff22';
                setTimeout(() => submitButton.style.boxShadow = '0 0 5px var(--neon-color-purple)', 2000);
            })
            .catch(error => {
                console.error("Error submitting rating: ", error);
                message.textContent = "Error submitting rating. Check console.";
                submitButton.disabled = false; 
                submitButton.textContent = "Submit Rating (Error)";
            });
        });


        // 6. Live Rating Calculation and Display 
        ratingsRef.on('value', (snapshot) => {
            let totalRating = 0;
            let count = 0;
            
            if (snapshot.exists()) {
                snapshot.forEach((childSnapshot) => {
                    const ratingData = childSnapshot.val();
                    if (ratingData && ratingData.rating) {
                        totalRating += ratingData.rating;
                        count++;
                    }
                });
            }

            const avgRating = count > 0 ? (totalRating / count).toFixed(1) : "N/A";

            avgRatingSpan.textContent = Average Rating: ${avgRating} / 5.0;
            userCountSpan.textContent = (${count} users rated);
        });

        // 7. Theme Toggle (Placeholder)
        themeToggle.addEventListener('click', () => {
            alert("Theme toggle functionality is a placeholder. Current dark mode style is applied.");
        });


        // Initial setup
        updateStarDisplay(0, true);
    </script>
</body>
</html>
